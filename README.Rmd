---
output: github_document
bibliography: '`r system.file("REFERENCES.bib", package="reluxr")`'
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# reluxr

<!-- badges: start -->

[![R-CMD-check](https://github.com/BradyAJohnston/reluxr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/BradyAJohnston/reluxr/actions/workflows/R-CMD-check.yaml) [![CRAN status](https://www.r-pkg.org/badges/version/reluxr)](https://CRAN.R-project.org/package=reluxr) [![reluxr status badge](https://bradyajohnston.r-universe.dev/badges/reluxr)](https://bradyajohnston.r-universe.dev) [![:name status badge](https://bradyajohnston.r-universe.dev/badges/:name)](https://bradyajohnston.r-universe.dev)

<!-- badges: end -->

The goal of `{reluxr}` is to enable deconvolution of luminescencent plate-based experiments. The implementation is based on the MatLab implementation from the paper titled **1Deconvolution of Luminescence Cross-Talk in High-Throughput Gene Expression Profiling' @mauri2019**

## Installation

You can install the development version of reluxr from [GitHub](https://github.com/) with:

``` r
install.package("reluxr", repos = "https://bradyajohnston.r-universe.dev")
```

## Example

This is a basic example which shows you how to solve a common problem:

```{r example}
library(reluxr)
library(dplyr)
library(ggplot2)

fl <- system.file(
   "extdata",
   "calibrate_tecan",
   "calTecan1.xlsx",
   package = "reluxr"
 )
```

## Create a Deconvolution Matrix

```{r}
dat <- plate_read_tecan(fl)

dat

mat_d_best <- dat |>
  filter(signal != "OD600") |> 
  filter(time_s > 500) |> 
  rl_calc_decon_matrix(value, time_s, ref_well = "E05", b_noise = 30)

image(log10(mat_d_best))
```

Plot the values.

```{r}
rl_plot_time <- function(data, time, value, group = "well") {
  
  data <- dplyr::mutate(
    data, 
    time = {{ time }}, 
    value = {{ value }}, 
    group = {{ group }}
  )
  
  plt <- ggplot2::ggplot(
    data, 
    mapping = ggplot2::aes(
      x = time,
      y = value, 
      group = group
    )
  ) + 
    ggplot2::geom_line() + 
    ggplot2::scale_y_log10() + 
    ggplot2::theme_bw()
  
  plt
}
```

```{r}
dat |>
  ungroup() |> 
  filter(signal == "LUMI") |> 
  rl_plot_time(time_s, value, well) + 
  labs(
    x = "Time (s)", 
    y = "LUM"
  )
dat |>
  ungroup() |> 
  filter(signal == "LUMI") |> 
  rl_adjust_plate(value, mat_d_best, time = time_s) |>
  rl_plot_time(time_s, value, well) + 
  labs(
    x = "Time (s)", 
    y = "LUM"
  )


```

```{r}

fl <- system.file(
  "extdata",
  "calibrate_tecan",
  "calTecan1.xlsx",
  package = "reluxr"
)

dat <- plate_read_tecan(fl)

mat_d_best <- dat |>
  filter(signal != "OD600") |>
  filter(time_s > 500) |>
  rl_calc_decon_matrix("value", "time_s", ref_well = "E05", b_noise = 30)

dat |>
  ungroup() |>
  summarise(value = mean(value), .by = well) |>
  rl_plot_plate(value, trans = log10) +
  scale_fill_viridis_c(
    limits = c(1, NA)
  )

dat |>
  ungroup() |>
  filter(signal == "LUMI") |>
  rl_adjust_plate(value, mat_d_best, time = time_s) |>
  summarise(value = mean(value), .by = well) |>
  rl_plot_plate(value, trans = log10) +
  scale_fill_viridis_c(
    limits = c(1, NA)
  )
```
